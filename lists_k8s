[K8S]
k8s-m1 ansible_ssh_host=192.168.13.142 ETCD="yes" K8S="both"
k8s-n1 ansible_ssh_host=192.168.13.145 ETCD="yes" K8S="slave"
k8s-n2 ansible_ssh_host=192.168.13.172 ETCD="yes" K8S="slave"

[K8S:vars]
Master="master.service.upyun"
Flannel_IPS="10.0.0.0/16"
Docker_Opts="-g /disk/ssd1/docker --log-opt max-size=1g"
Docker_Registry="registry.service.upyun:5000"
Docker_Mirror="https://registry.docker-cn.com"

# grub2-set-default "`sed -r -n "s/^menuentry '(.*)' --class.*/\1/p" /boot/grub2/grub.cfg|grep 4.16`"
# grub2-mkconfig -o /boot/grub2/grub.cfg

# yum makecache fast
# yum --enablerepo=docker-ce-stable  --showduplicates list docker-ce
# yum --enablerepo=kubernetes list kubelet kubeadm kubectl 
# yum --enablerepo=docker-ce-stable --enablerepo=kubernetes install docker-ce-17.03.2.ce-1.el7.centos kubelet kubeadm kubectl
# kubeadm init --kubernetes-version=v1.10.3 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=0.0.0.0 # 初始化集群
# kubectl apply -f http://mirror.faasx.com/kubernetes/installation/hosted/kubeadm/1.7/calico.yaml # 安装calico网络
# kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml # 安装flannel网络
# kubectl taint nodes k8s-m1 node-role.kubernetes.io/master- # 允许master参与工作负载分担

# 安装dashboard & heapster
# kubectl apply -f http://mirror.faasx.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml
# kubectl create -f http://mirror.faasx.com/kubernetes/heapster/deploy/kube-config/influxdb/influxdb.yaml
# kubectl create -f http://mirror.faasx.com/kubernetes/heapster/deploy/kube-config/influxdb/grafana.yaml
# kubectl create -f http://mirror.faasx.com/kubernetes/heapster/deploy/kube-config/influxdb/heapster.yaml
# kubectl create -f http://mirror.faasx.com/kubernetes/heapster/deploy/kube-config/rbac/heapster-rbac.yaml

# 创建admin-user账号和权限，用于访问 dashboard
# kubectl create -f admin-user.yaml
# kubectl create -f admin-user-role-binding.yaml
# kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')

# docker pull registry:2
# docker run -tid --restart=always -p 5000:5000 --name registry -v /data/registry:/var/lib/registry registry:2 
# 将registry的数据卷与本地关联，便于管理和备份registry数据
# docker pull nginx # 从外网registry拉一个nginx镜像过来
# docker tag nginx registry.service.upyun:5000/nginx # 为本地镜像打tag
# docker push registry.service.upyun:5000/nginx # 推送至本地registry
# docker rmi registry.service.upyun:5000/nginx # 删除本地镜像
